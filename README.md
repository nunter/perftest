# 性能测试自动化工具

## 项目概述

这是一个分布式性能测试框架，用于自动化执行、监控和报告 Web API 的性能测试。本项目采用主从（Master-Slave）架构，支持多节点分布式压测，可以模拟高并发场景下的系统性能表现。

## 系统截图

### 主测试界面
![测试执行界面](docs/images/test_execution.png)

### 报告列表页面
![报告列表界面](docs/images/report_list.png)

### 性能对比报告
![性能对比报告](docs/images/comparison_report.png)

## 系统架构

本系统采用现代化的分布式微服务架构，由以下核心组件构成：

![系统架构图](docs/images/architecture.svg)

### 核心组件

1. **Web前端**
   - 基于Vue.js和Bootstrap构建的现代化交互界面
   - 提供直观的测试配置、执行和监控功能
   - 实时展示测试进度和性能指标

2. **后端服务**
   - 采用Python + Flask框架开发
   - 提供RESTful API接口
   - 负责测试任务调度和资源管理
   - 集成WebSocket实现实时数据推送

3. **JMeter分布式引擎**
   - 采用Master-Slave分布式架构
   - Master节点负责任务分发和结果聚合
   - Slave节点执行具体的性能测试任务
   - 支持动态扩展测试节点

4. **数据存储层**
   - 使用SQLite数据库存储测试配置和结果
   - 文件系统管理测试脚本和报告文件
   - 支持历史数据查询和分析

5. **报告分析系统**
   - 自动化生成HTML格式测试报告
   - 支持多维度数据分析和可视化
   - 提供测试结果对比功能

6. **通知系统**
   - 集成企业微信实现消息通知
   - 支持测试完成和异常告警通知
   - 可配置的通知规则

### 系统特点

- **高可扩展性**：分布式架构设计，支持水平扩展测试节点
- **实时监控**：WebSocket实现测试过程实时监控
- **数据可视化**：直观展示性能测试数据和趋势
- **自动化流程**：从测试执行到报告生成的全流程自动化
- **可靠性保障**：完善的错误处理和异常恢复机制

## 主要特性

- 分布式负载测试：支持多个性能测试引擎节点并行执行测试
- 全新Web界面：全新的交互式Web界面，可视化展示测试过程和结果
- 参数化测试：通过界面自定义并发用户数、测试时长等关键参数
- 自动化报告生成：测试完成后自动生成 HTML 格式的详细报告
- 实时监控：测试过程中实时输出日志和状态信息，支持日志过滤和自动滚动
- 企业微信通知：测试完成后可发送结果通知到企业微信
- 多步骤测试：支持设置测试步骤数量，自动控制测试进程
- 服务器状态检查：测试前自动检查远程服务器状态

## 目录结构

- `apache-jmeter/`: 性能测试核心执行引擎
- `testplan/`: 存放性能测试计划文件
- `report/html/`: 测试报告输出目录
- `jtl/`: 测试结果数据文件
- `log/`: 执行日志
- `file/`: 测试相关资源文件
- `uploads/`: 上传文件目录
- `reportdiff/`: 报告比对工具
- `templates/`: Web界面模板文件
- `static/`: Web界面静态资源
- `init/`: 系统服务启动脚本

## 使用方法

### 命令行方式

执行测试:

```bash
./run_test.sh [-f 性能测试文件名] [-n 并发用户数] [-t 压测时间(秒)] [-b 后台运行]
```

示例:
```bash
# 前台运行，实时查看日志
./run_test.sh -f sample -n 100 -t 300

# 后台运行，日志写入文件
./run_test.sh -f sample -n 100 -t 300 -b
```

### Web界面方式

启动Web应用:

```bash
python app.py
```

或使用启动脚本:

```bash
./run_webapp.sh
```

访问 http://localhost:5001 打开Web界面

#### Web界面功能:

- **测试执行**: 
  - 选择测试文件
  - 设置并发用户数
  - 设置测试步骤数
  - 设置测试持续时间
  - 实时监控测试进度
  
- **日志查看**:
  - 实时监控测试日志
  - 日志级别过滤 (全部/INFO+/WARN+/ERROR)
  - 日志自动滚动开关
  - 日志清空功能
  
- **服务器状态**:
  - 检查远程服务器状态
  - 显示服务器连接状态和详细信息

- **测试报告**:
  - 查看历史测试报告
  - 分析测试结果数据
  - 对比不同测试报告的性能差异

## 部署方式

### 1. 常规部署

请参照 `README_WEBAPP.md` 中的指南进行部署。

### 2. 系统服务部署

在 CentOS 系统中，可以使用 init 目录下的启动脚本将应用部署为系统服务：

```bash
# 复制脚本到系统 init 目录
sudo cp init/perftest-webapp /etc/rc.d/init.d/

# 设置执行权限
sudo chmod 755 /etc/rc.d/init.d/perftest-webapp

# 将服务添加到系统服务
sudo chkconfig --add perftest-webapp

# 设置系统启动时自动启动
sudo chkconfig perftest-webapp on
```

更多详细信息，请参阅 `init/README.md`。

## 报告比对工具

项目包含一个报告比对工具 (`reportdiff/`)，用于对比不同测试报告的性能差异。

### 部署报告比对工具

```bash
cd reportdiff
./deploy.sh
```

部署成功后，可以通过 http://localhost:5001 访问报告比对工具。

## 环境要求

- Python 3.7+
- Bash 环境
- JMeter 5.6.2+
- 远程性能测试服务器配置正确并已启动
- 网络可访问被测目标系统
- Docker 和 Docker Compose（用于部署报告比对工具）

## TODO
- [ ] 执行压测后加入 nmon 资源监控功能
- [ ] 支持自动生成资源监控报告
- [ ] 获取业务监控图表
- [ ] 支持并发用户 VS 响应时间图表
- [ ] 支持并发用户 VS 吞吐量图表
- [ ] 支持并发用户 VS 错误率图表
- [ ] 支持并发用户 VS 响应时间百分比图表
- [ ] 支持并发用户 VS 吞吐量百分比图表


## 更新日志

### 2024-05

- 全新Web界面上线，支持实时日志监控
- 改进测试执行流程，增加多步骤支持
- 优化日志展示，增加过滤和自动滚动功能
- 增加服务器状态检查功能
- 界面优化，确保左右两边面板高度一致
- 添加系统服务部署脚本，支持CentOS自启动

